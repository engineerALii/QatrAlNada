<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¯Ø±Ø³Ø© Ù‚Ø·Ø± Ø§Ù„Ù†Ø¯Ù‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</title>
    
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª (Favicon) Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØµØ§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… q.png -->
    <link rel="icon" type="image/png" sizes="16x16" href="q.PNG">
    <link rel="icon" type="image/png" sizes="32x32" href="q.PNG">
    <link rel="icon" type="image/png" sizes="48x48" href="q.PNG">
    <link rel="icon" type="image/png" sizes="96x96" href="q.PNG">
    
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø¬Ù‡Ø²Ø© Apple (iPhone/iPad) -->
    <link rel="apple-touch-icon" sizes="180x180" href="q.PNG">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Ø±Ø§Ø¨Ø· Ù…Ù„Ù Manifest Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª PWA (Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù„ÙŠØ´ÙŠØ± Ù„Ù†ÙØ³ Ø§Ù„ØµÙˆØ±Ø©) -->
    <link rel="manifest" id="manifest-link">

    <!-- Ø®Ø· ØªØ¬ÙˆØ§Ù„ Ù…Ù† Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- ØªØ®ØµÙŠØµØ§Øª Tailwind ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† -->
    <script>
        tailwind.config = {
            darkMode: 'class', // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø¹Ø¨Ø± Ø§Ù„ÙƒÙ„Ø§Ø³
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        primary: '#0d9488', // Teal 600
                        secondary: '#0f766e', // Teal 700
                        accent: '#f0fdf4', // Green 50
                        danger: '#ef4444',
                        // Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø§Ù„Ù…Ø®ØµØµØ©
                        darkBg: '#0f172a', // Slate 900
                        darkSurface: '#1e293b', // Slate 800
                        darkBorder: '#334155', // Slate 700
                    }
                }
            }
        }
    </script>

    <style>
        /* Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø³Ù„Ø³ Ù„Ù„Ø£Ù„ÙˆØ§Ù† */
        body, div, nav, button, input, select, textarea, table, tr, td, th {
            transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        border-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        color 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body { background-color: #f1f5f9; }
        .dark body { background-color: #0f172a; }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #toast-container { position: fixed; bottom: 20px; left: 20px; z-index: 100; }
        
        /* Modal Styles */
        .modal { transition: opacity 0.3s ease; }
        .modal-content { transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .modal.active { opacity: 1; pointer-events: auto; }
        .modal.active .modal-content { transform: scale(1); }
        .modal.hidden-modal { opacity: 0; pointer-events: none; }

        /* Ø£Ù†Ù…ÙŠØ´Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø«ÙŠÙ… */
        @keyframes spin-rotate {
            0% { transform: rotate(0deg) scale(0.5); opacity: 0; }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); opacity: 1; }
        }
        .theme-icon-anim {
            animation: spin-rotate 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 font-sans antialiased bg-slate-100 dark:bg-slate-900 transition-colors duration-300">

    <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="flex h-screen overflow-hidden">

        <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) -->
        <aside class="w-64 bg-white dark:bg-slate-800 border-l border-slate-200 dark:border-slate-700 hidden md:flex flex-col z-10 shadow-lg transition-colors">
            <div class="p-6 flex items-center justify-center border-b border-slate-100 dark:border-slate-700">
                <div class="flex flex-col items-center gap-2 text-primary dark:text-teal-400 font-bold text-lg text-center leading-tight">
                    <!-- Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø§Ù„ØµÙˆØ±Ø© -->
                    <img src="q.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="w-16 h-16 object-contain mb-2">
                    <span>Ù‚Ø·Ø± Ø§Ù„Ù†Ø¯Ù‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</span>
                </div>
            </div>
            
            <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-2">
                <button onclick="router('dashboard')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 transition-all active-nav">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </button>
                <button onclick="router('students')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 transition-all">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                </button>
                <button onclick="router('teachers')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 transition-all">
                    <i data-lucide="contact" class="w-5 h-5"></i>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</span>
                </button>
                <button onclick="router('attendance')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 transition-all">
                    <i data-lucide="calendar-check" class="w-5 h-5"></i>
                    <span>Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</span>
                </button>
                <button onclick="router('grades')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 transition-all">
                    <i data-lucide="file-bar-chart" class="w-5 h-5"></i>
                    <span>Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</span>
                </button>
                <button onclick="router('notifications')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 transition-all">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
                </button>
            </nav>
            <div class="p-4 border-t border-slate-100 dark:border-slate-700 text-center text-xs text-slate-400 dark:text-slate-500">
                <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± -->
            </div>
        </aside>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
            <header class="bg-white dark:bg-slate-800 h-16 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-4 sm:px-6 z-20 transition-colors">
                <div class="flex items-center gap-4">
                    <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <h2 id="page-title" class="text-lg font-bold text-slate-700 dark:text-slate-200">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… -->
                    <button onclick="toggleTheme()" class="p-2 text-slate-500 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors relative overflow-hidden group" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±">
                        <div id="theme-icon-container">
                            <i data-lucide="moon" class="w-5 h-5 theme-icon-anim"></i>
                        </div>
                    </button>

                    <button onclick="router('notifications')" class="p-2 relative text-slate-500 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span id="notif-badge" class="hidden absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white dark:border-slate-800"></span>
                    </button>
                    <div class="flex items-center gap-2 border-r border-slate-200 dark:border-slate-700 pr-3 mr-1">
                        <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold">Ù…</div>
                        <span class="hidden sm:inline text-sm font-medium text-slate-600 dark:text-slate-300">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</span>
                    </div>
                </div>
            </header>

            <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
            <div id="mobile-menu-overlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>
            <div id="mobile-menu" class="fixed inset-y-0 right-0 w-64 bg-white dark:bg-slate-800 z-40 transform translate-x-full transition-transform duration-300 md:hidden flex flex-col shadow-2xl">
                 <div class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                    <span class="font-bold text-primary dark:text-teal-400">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
                    <button onclick="toggleMobileMenu()"><i data-lucide="x" class="w-6 h-6 text-slate-500 dark:text-slate-400"></i></button>
                 </div>
                 <nav class="p-4 space-y-2 flex-1">
                    <button onclick="router('dashboard'); toggleMobileMenu()" class="w-full text-right px-4 py-3 rounded-lg hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 text-slate-700 dark:text-slate-200 flex gap-2"><i data-lucide="layout-dashboard"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                    <button onclick="router('students'); toggleMobileMenu()" class="w-full text-right px-4 py-3 rounded-lg hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 text-slate-700 dark:text-slate-200 flex gap-2"><i data-lucide="users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
                    <button onclick="router('teachers'); toggleMobileMenu()" class="w-full text-right px-4 py-3 rounded-lg hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 text-slate-700 dark:text-slate-200 flex gap-2"><i data-lucide="contact"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
                    <button onclick="router('attendance'); toggleMobileMenu()" class="w-full text-right px-4 py-3 rounded-lg hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 text-slate-700 dark:text-slate-200 flex gap-2"><i data-lucide="calendar-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</button>
                    <button onclick="router('grades'); toggleMobileMenu()" class="w-full text-right px-4 py-3 rounded-lg hover:bg-accent dark:hover:bg-slate-700 hover:text-primary dark:hover:text-teal-400 text-slate-700 dark:text-slate-200 flex gap-2"><i data-lucide="file-bar-chart"></i> Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button>
                 </nav>
            </div>

            <div id="content-area" class="flex-1 overflow-y-auto p-4 sm:p-6 bg-slate-50 dark:bg-slate-900 relative transition-colors"></div>
            
            <footer class="bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 py-2 px-4 text-center text-xs text-slate-500 dark:text-slate-400 transition-colors shrink-0">
                <div class="flex flex-col md:flex-row justify-between items-center gap-1">
                    <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2024 Ù„Ù…Ø¯Ø±Ø³Ø© Ù‚Ø·Ø± Ø§Ù„Ù†Ø¯Ù‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ù‡Ù„ÙŠØ©.</span>
                    <span class="font-medium text-primary dark:text-teal-400">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø¹Ù„ÙŠ ØªØ§ÙˆØ³</span>
                </div>
            </footer>
        </main>
    </div>

    <!-- Modal (Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©) -->
    <div id="main-modal" class="modal hidden-modal fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="modal-content bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden ring-1 ring-slate-200 dark:ring-slate-700">
            <div class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                <h3 id="modal-title" class="font-bold text-lg text-slate-800 dark:text-slate-100">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø§ÙØ°Ø©</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 transition"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="modal-body" class="p-6 text-slate-700 dark:text-slate-300"></div>
        </div>
    </div>

    <!-- Modal Confirm (Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù) -->
    <div id="confirm-modal" class="modal hidden-modal fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="modal-content bg-white dark:bg-slate-800 w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden p-6 text-center ring-1 ring-slate-200 dark:ring-slate-700">
            <div class="w-16 h-16 bg-red-100 dark:bg-red-900/30 text-red-500 dark:text-red-400 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                <i data-lucide="alert-triangle" class="w-8 h-8"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-800 dark:text-slate-100 mb-2">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</h3>
            <p class="text-slate-500 dark:text-slate-400 mb-6 text-sm">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŒ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closeDeleteModal()" class="px-5 py-2.5 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-300 font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition w-full">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="confirmDelete()" class="px-5 py-2.5 rounded-lg bg-red-500 text-white font-medium hover:bg-red-600 transition shadow-lg shadow-red-500/30 w-full flex justify-center gap-2 items-center">
                    <i data-lucide="trash-2" class="w-4 h-4"></i> Ø­Ø°Ù
                </button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© manifest.json Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… q.png ---
        function initManifest() {
            const manifest = {
                "name": "Ù…Ø¯Ø±Ø³Ø© Ù‚Ø·Ø± Ø§Ù„Ù†Ø¯Ù‰",
                "short_name": "Ù‚Ø·Ø± Ø§Ù„Ù†Ø¯Ù‰",
                "description": "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¯Ø±Ø³Ø© Ù‚Ø·Ø± Ø§Ù„Ù†Ø¯Ù‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ù‡Ù„ÙŠØ©",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#ffffff",
                "theme_color": "#0d9488",
                "icons": [
                    {
                        "src": "q.png",
                        "sizes": "192x192",
                        "type": "image/png"
                    },
                    {
                        "src": "q.png",
                        "sizes": "512x512",
                        "type": "image/png"
                    }
                ]
            };
            
            const stringManifest = JSON.stringify(manifest);
            const blob = new Blob([stringManifest], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(blob);
            document.querySelector('#manifest-link').setAttribute('href', manifestURL);
        }

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ---
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† localStorage Ø£Ùˆ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                updateThemeIcon(true);
            } else {
                document.documentElement.classList.remove('dark');
                updateThemeIcon(false);
            }
        }

        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            
            if (isDark) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                updateThemeIcon(false);
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                updateThemeIcon(true);
            }
        }

        function updateThemeIcon(isDark) {
            const container = document.getElementById('theme-icon-container');
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
            container.innerHTML = ''; 
            const icon = document.createElement('i');
            // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³Ø§Øª Lucide ÙˆÙƒÙ„Ø§Ø³ Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø§
            icon.className = `w-5 h-5 theme-icon-anim ${isDark ? 'text-yellow-400' : 'text-slate-600 dark:text-slate-300'}`;
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ø³Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ø´Ù…Ø³ Ø£Ùˆ Ù‚Ù…Ø±)
            icon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
            
            container.appendChild(icon);
            lucide.createIcons();
        }

        // --- 1. Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙ‡ÙŠØ¦ØªÙ‡Ø§ ---
        const defaultStudents = [
            { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', grade: 'Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', section: 'Ø£', shift: 'ØµØ¨Ø§Ø­ÙŠ', phone: '0551234567', attendanceHistory: [], marks: {} },
            { id: 2, name: 'Ø³Ø§Ø±Ø© Ø®Ø§Ù„Ø¯ Ø¹Ù…Ø±', grade: 'Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', section: 'Ø¨', shift: 'Ø¸Ù‡Ø±ÙŠ', phone: '0559876543', attendanceHistory: [], marks: {} },
            { id: 3, name: 'ÙŠÙˆØ³Ù Ø­Ø³Ù† Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', grade: 'Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', section: 'Ø£', shift: 'ØµØ¨Ø§Ø­ÙŠ', phone: '0501122334', attendanceHistory: [], marks: {} },
        ];
        
        const defaultTeachers = [
            { id: 1, name: 'Ø¯. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ù†ØµÙˆØ±', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', phone: '0599998888' },
            { id: 2, name: 'Ø£. Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø¹Ø§Ù…Ø±', subject: 'Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©', phone: '0544443333' },
        ];

        const defaultNotifications = [
            { id: 1, title: 'ØªØ±Ø­ÙŠØ¨', body: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯', date: new Date().toLocaleDateString('ar-EG'), type: 'info' }
        ];

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const schoolSubjects = [
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
            'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©',
            'Ø§Ù„Ø¹Ù„ÙˆÙ…',
            'Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
            'Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©',
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©',
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©',
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©'
        ];

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
        const schoolGrades = [
            'Ø§Ù„Ø£ÙˆÙ„ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ'
        ];

        let students = JSON.parse(localStorage.getItem('students')) || defaultStudents;
        let teachers = JSON.parse(localStorage.getItem('teachers')) || defaultTeachers;
        let notifications = JSON.parse(localStorage.getItem('notifications')) || defaultNotifications;

        students.forEach(s => {
            if(!s.marks) s.marks = {};
            if(!s.attendanceHistory) s.attendanceHistory = [];
            if(!s.shift) s.shift = 'ØµØ¨Ø§Ø­ÙŠ'; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        });

        function saveData() {
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('teachers', JSON.stringify(teachers));
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateNotifBadge();
        }

        // --- 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙˆØ§Ù„Ø¹Ø±Ø¶ ---
        let currentSubject = 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'; 
        let currentGradeLevel = 'Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ'; // Ø§Ù„ØµÙ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¹Ø±Ø¶
        let deleteTarget = null; 

        function router(pageId) {
            const content = document.getElementById('content-area');
            const title = document.getElementById('page-title');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isActive = btn.getAttribute('onclick').includes(pageId);
                btn.classList.toggle('bg-accent', isActive);
                btn.classList.toggle('dark:bg-slate-700', isActive);
                btn.classList.toggle('text-primary', isActive);
                btn.classList.toggle('dark:text-teal-400', isActive);
            });

            title.textContent = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'students': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨', 'teachers': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†',
                'attendance': 'Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±', 'grades': 'Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬', 'notifications': 'Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª'
            }[pageId];

            content.classList.remove('fade-in');
            void content.offsetWidth;
            content.classList.add('fade-in');

            if(pageId === 'dashboard') renderDashboard();
            else if(pageId === 'students') renderStudents();
            else if(pageId === 'teachers') renderTeachers();
            else if(pageId === 'attendance') renderAttendance();
            else if(pageId === 'grades') renderGrades();
            else if(pageId === 'notifications') renderNotifications();
            
            lucide.createIcons();
            updateNotifBadge();
        }

        // --- 3. ØµÙØ­Ø§Øª ÙˆÙ…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ) ---

        function renderDashboard() {
            const studentCount = students.length;
            const teacherCount = teachers.length;
            
            let totalDays = 0, presentDays = 0;
            students.forEach(s => {
                s.attendanceHistory.forEach(day => {
                    totalDays++;
                    if(day.status === 'present') presentDays++;
                });
            });
            const attendanceRate = totalDays === 0 ? 100 : Math.round((presentDays / totalDays) * 100);

            document.getElementById('content-area').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex justify-between items-center transition-colors">
                        <div><p class="text-slate-500 dark:text-slate-400 text-sm">Ø§Ù„Ø·Ù„Ø§Ø¨</p><h3 class="text-2xl font-bold dark:text-white">${studentCount}</h3></div>
                        <div class="bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 p-3 rounded-lg"><i data-lucide="users"></i></div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex justify-between items-center transition-colors">
                        <div><p class="text-slate-500 dark:text-slate-400 text-sm">Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</p><h3 class="text-2xl font-bold dark:text-white">${teacherCount}</h3></div>
                        <div class="bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 p-3 rounded-lg"><i data-lucide="contact"></i></div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex justify-between items-center transition-colors">
                        <div><p class="text-slate-500 dark:text-slate-400 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p><h3 class="text-2xl font-bold ${attendanceRate < 90 ? 'text-orange-500' : 'text-green-600 dark:text-green-400'}">${attendanceRate}%</h3></div>
                        <div class="bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 p-3 rounded-lg"><i data-lucide="percent"></i></div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex justify-between items-center transition-colors">
                        <div><p class="text-slate-500 dark:text-slate-400 text-sm">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p><h3 class="text-2xl font-bold dark:text-white">${notifications.length}</h3></div>
                        <div class="bg-orange-50 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 p-3 rounded-lg"><i data-lucide="bell"></i></div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 transition-colors">
                        <h3 class="font-bold mb-4 dark:text-white">Ø£Ø­Ø¯Ø« Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                        <div class="table-responsive">
                            <table class="w-full text-right text-sm">
                                <thead class="text-slate-500 dark:text-slate-400 border-b dark:border-slate-700"><tr><th class="pb-2">Ø§Ù„Ø§Ø³Ù…</th><th class="pb-2">Ø§Ù„Ù‚Ø³Ù…</th></tr></thead>
                                <tbody class="divide-y dark:divide-slate-700">${students.slice(0, 5).map(s => `<tr class="dark:text-slate-300"><td class="py-2">${s.name}</td><td class="py-2 text-slate-500 dark:text-slate-400">${s.grade} - ${s.section}</td></tr>`).join('')}</tbody>
                            </table>
                        </div>
                    </div>
                     <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 transition-colors">
                        <h3 class="font-bold mb-4 dark:text-white">Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                        <div class="space-y-3">
                            ${notifications.slice(0, 3).map(n => `
                                <div class="flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                                    <div class="mt-1 w-2 h-2 rounded-full ${n.type === 'alert' ? 'bg-red-500' : 'bg-blue-500'}"></div>
                                    <div><p class="text-sm font-bold dark:text-slate-200">${n.title}</p><p class="text-xs text-slate-500 dark:text-slate-400">${n.body}</p></div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStudents() {
            document.getElementById('content-area').innerHTML = `
                <div class="flex flex-col sm:flex-row justify-between gap-4 mb-6">
                    <div class="relative w-full sm:w-64">
                        <input type="text" id="search-student" onkeyup="filterStudents()" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." class="w-full pl-4 pr-10 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:border-primary dark:focus:border-teal-500 dark:text-white transition-colors">
                        <i data-lucide="search" class="absolute right-3 top-2.5 text-slate-400 w-4 h-4"></i>
                    </div>
                    <button onclick="openModal('addStudent')" class="bg-primary hover:bg-secondary dark:bg-teal-600 dark:hover:bg-teal-700 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-colors"><i data-lucide="plus" class="w-4 h-4"></i> Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden border border-slate-100 dark:border-slate-700 transition-colors">
                    <div class="table-responsive">
                        <table class="w-full text-right text-sm">
                            <thead class="bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400"><tr><th class="p-4">Ø§Ù„Ø§Ø³Ù…</th><th class="p-4">Ø§Ù„ØµÙ</th><th class="p-4">Ø§Ù„Ù‡Ø§ØªÙ</th><th class="p-4 text-center">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                            <tbody id="students-table-body" class="divide-y divide-slate-100 dark:divide-slate-700">${getStudentsRows()}</tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getStudentsRows(filter = '') {
            const filtered = students.filter(s => s.name.includes(filter));
            if (!filtered.length) return '<tr><td colspan="4" class="p-6 text-center text-slate-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
            return filtered.map(s => `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors dark:text-slate-300">
                    <td class="p-4 font-medium flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-primary dark:text-teal-400 font-bold text-xs">${s.name[0]}</div>${s.name}</td>
                    <td class="p-4">
                        <div class="flex flex-col gap-1">
                            <span>${s.grade} - Ø´Ø¹Ø¨Ù‡ (${s.section})</span>
                            <span class="text-xs px-2 py-0.5 rounded w-fit ${s.shift === 'ØµØ¨Ø§Ø­ÙŠ' ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' : 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400'}">
                                ${s.shift === 'ØµØ¨Ø§Ø­ÙŠ' ? 'â˜€ï¸ ØµØ¨Ø§Ø­ÙŠ' : 'ğŸŒ‘ Ø¸Ù‡Ø±ÙŠ'}
                            </span>
                        </div>
                    </td>
                    <td class="p-4 font-mono text-slate-500 dark:text-slate-400">${s.phone}</td>
                    <td class="p-4 text-center"><button onclick="openDeleteModal('student', ${s.id})" class="text-red-500 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-2 rounded hover:bg-red-100 dark:hover:bg-red-900/40 transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                </tr>
            `).join('');
        }

        function renderTeachers() {
            document.getElementById('content-area').innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-lg dark:text-white">Ø§Ù„ÙƒØ§Ø¯Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                    <button onclick="openModal('addTeacher')" class="bg-slate-800 dark:bg-slate-700 text-white px-4 py-2 rounded-lg text-sm flex gap-2 items-center hover:bg-slate-900 dark:hover:bg-slate-600 transition-colors"><i data-lucide="plus" class="w-4 h-4"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${teachers.map(t => `
                        <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 hover:shadow-md transition relative group">
                            <button onclick="openDeleteModal('teacher', ${t.id})" class="absolute top-4 left-4 text-red-400 hover:text-red-600 dark:text-red-400 opacity-0 group-hover:opacity-100 transition bg-red-50 dark:bg-red-900/20 p-2 rounded-full"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                            <div class="w-16 h-16 bg-slate-100 dark:bg-slate-700 rounded-full mx-auto mb-4 flex items-center justify-center text-2xl">ğŸ‘¨â€ğŸ«</div>
                            <h4 class="font-bold text-center text-lg dark:text-white">${t.name}</h4>
                            <p class="text-primary dark:text-teal-400 text-center text-sm mb-4">${t.subject}</p>
                            <div class="flex justify-center gap-3">
                                <a href="tel:${t.phone}" class="bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 hover:bg-green-100 dark:hover:bg-green-900/40 transition"><i data-lucide="phone" class="w-3 h-3"></i> Ø§ØªØµÙ„</a>
                            </div>
                        </div>
                    `).join('')}
                    ${teachers.length === 0 ? '<p class="text-slate-400 col-span-3 text-center py-10">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…ÙŠÙ† Ø¨Ø¹Ø¯</p>' : ''}
                </div>
            `;
        }

        function renderAttendance() {
            const today = new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('content-area').innerHTML = `
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 transition-colors">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                        <div><h3 class="font-bold text-lg dark:text-white">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3><p class="text-slate-500 dark:text-slate-400 text-sm mt-1">${today}</p></div>
                        <div class="flex gap-2">
                             <button onclick="window.print()" class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-4 py-2 rounded-lg flex gap-2 text-sm hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors"><i data-lucide="printer" class="w-4 h-4"></i> Ø·Ø¨Ø§Ø¹Ø©</button>
                            <button onclick="saveAttendance()" class="bg-primary hover:bg-secondary dark:bg-teal-600 dark:hover:bg-teal-700 text-white px-6 py-2 rounded-lg text-sm font-bold shadow-sm shadow-primary/30 transition-colors">Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="w-full text-right text-sm">
                            <thead class="bg-slate-50 dark:bg-slate-700/50 border-b dark:border-slate-700 text-slate-500 dark:text-slate-400">
                                <tr><th class="p-3">Ø§Ù„Ø·Ø§Ù„Ø¨</th><th class="p-3 text-center">Ø­Ø§Ø¶Ø±</th><th class="p-3 text-center">ØºØ§Ø¦Ø¨</th><th class="p-3 text-center">Ø¥Ø°Ù†</th></tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100 dark:divide-slate-700">
                                ${students.map(s => `
                                    <tr class="dark:text-slate-300">
                                        <td class="p-3 font-medium">${s.name}</td>
                                        <td class="p-3 text-center"><input type="radio" name="att_${s.id}" value="present" checked class="accent-green-600 w-5 h-5 cursor-pointer"></td>
                                        <td class="p-3 text-center"><input type="radio" name="att_${s.id}" value="absent" class="accent-red-500 w-5 h-5 cursor-pointer"></td>
                                        <td class="p-3 text-center"><input type="radio" name="att_${s.id}" value="excused" class="accent-yellow-500 w-5 h-5 cursor-pointer"></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderGrades() {
            // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            const filteredStudents = students.filter(s => s.grade === currentGradeLevel);

            document.getElementById('content-area').innerHTML = `
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 transition-colors">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                        <h3 class="font-bold text-lg dark:text-white">Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
                        <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
                            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© -->
                            <select onchange="changeGradeLevel(this.value)" class="border border-slate-200 dark:border-slate-600 rounded-lg p-2 text-sm w-full md:w-48 bg-slate-50 dark:bg-slate-700 dark:text-white focus:border-primary outline-none transition-colors">
                                ${schoolGrades.map(g => `<option value="${g}" ${currentGradeLevel === g ? 'selected' : ''}>${g}</option>`).join('')}
                            </select>

                            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø© -->
                            <select id="subject-select" onchange="changeSubject(this.value)" class="border border-slate-200 dark:border-slate-600 rounded-lg p-2 text-sm w-full md:w-48 bg-slate-50 dark:bg-slate-700 dark:text-white focus:border-primary outline-none transition-colors">
                                ${schoolSubjects.map(sub => `<option value="${sub}" ${currentSubject === sub ? 'selected' : ''}>${sub}</option>`).join('')}
                            </select>
                            
                            <button onclick="saveGrades()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 text-sm font-bold shadow-sm shrink-0 transition-colors">Ø­ÙØ¸</button>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 items-center text-sm text-slate-600 dark:text-slate-300 mb-4 bg-slate-50 dark:bg-slate-900/50 p-3 rounded-lg border border-slate-100 dark:border-slate-700">
                         <i data-lucide="info" class="w-4 h-4 text-blue-500"></i>
                         <span>ÙŠØªÙ… Ø§Ù„Ø±ØµØ¯ Ù„Ø·Ù„Ø§Ø¨: <b>${currentGradeLevel}</b> - Ù…Ø§Ø¯Ø©: <b>${currentSubject}</b></span>
                    </div>

                    <div class="table-responsive">
                        <table class="w-full text-right text-sm">
                            <thead class="border-b dark:border-slate-700 bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400">
                                <tr>
                                    <th class="p-3 min-w-[150px]">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th class="p-3 w-24 text-center">Ø§Ø®ØªØ¨Ø§Ø± 1 (20)</th>
                                    <th class="p-3 w-24 text-center">Ù†ØµÙÙŠ (30)</th>
                                    <th class="p-3 w-24 text-center">Ù†Ù‡Ø§Ø¦ÙŠ (50)</th>
                                    <th class="p-3 w-24 text-center">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100 dark:divide-slate-700">
                                ${filteredStudents.length > 0 ? filteredStudents.map(s => {
                                    const m = s.marks[currentSubject] || { e1: '', mid: '', fin: '' };
                                    const total = (Number(m.e1) || 0) + (Number(m.mid) || 0) + (Number(m.fin) || 0);
                                    return `
                                    <tr class="dark:text-slate-300">
                                        <td class="p-3 font-medium">
                                            ${s.name}
                                            <span class="block text-xs text-slate-400 dark:text-slate-500 mt-1">${s.section} - ${s.shift}</span>
                                        </td>
                                        <td class="p-3"><input type="number" id="g_e1_${s.id}" value="${m.e1}" min="0" max="20" class="w-full border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 rounded p-1.5 text-center focus:border-primary outline-none transition-colors dark:text-white"></td>
                                        <td class="p-3"><input type="number" id="g_mid_${s.id}" value="${m.mid}" min="0" max="30" class="w-full border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 rounded p-1.5 text-center focus:border-primary outline-none transition-colors dark:text-white"></td>
                                        <td class="p-3"><input type="number" id="g_fin_${s.id}" value="${m.fin}" min="0" max="50" class="w-full border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 rounded p-1.5 text-center focus:border-primary outline-none transition-colors dark:text-white"></td>
                                        <td class="p-3 font-bold text-center text-primary dark:text-teal-400" id="g_total_${s.id}">${total || '--'}</td>
                                    </tr>
                                    `;
                                }).join('') : '<tr><td colspan="5" class="text-center p-8 text-slate-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderNotifications() {
            document.getElementById('content-area').innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-xl dark:text-white">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                        <button onclick="openModal('addNotif')" class="text-primary dark:text-teal-400 hover:bg-accent dark:hover:bg-slate-700 px-3 py-1 rounded-lg text-sm font-medium transition flex gap-1 items-center">Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙŠØ¯ <i data-lucide="send" class="w-4 h-4"></i></button>
                    </div>
                    <div class="space-y-4">
                        ${notifications.map(n => `
                            <div class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border-r-4 ${n.type === 'alert' ? 'border-red-500' : 'border-blue-500'} flex gap-4 animate-slide-in border-y border-l border-slate-100 dark:border-slate-700 transition-colors">
                                <div class="${n.type === 'alert' ? 'bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400' : 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400'} p-3 rounded-full h-fit shadow-sm">
                                    <i data-lucide="${n.type === 'alert' ? 'alert-circle' : 'info'}" class="w-6 h-6"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <h4 class="font-bold text-slate-800 dark:text-slate-100 text-lg">${n.title}</h4>
                                        <span class="text-xs text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded">${n.date}</span>
                                    </div>
                                    <p class="text-slate-600 dark:text-slate-400 mt-2 leading-relaxed">${n.body}</p>
                                </div>
                            </div>
                        `).join('')}
                        ${notifications.length === 0 ? '<div class="text-center py-10 text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>' : ''}
                    </div>
                </div>
            `;
        }

        // --- 4. Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© (Actions) ---

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            const isHidden = menu.classList.contains('translate-x-full');
            
            menu.classList.toggle('translate-x-full', !isHidden);
            overlay.classList.toggle('hidden', !isHidden);
        }

        function filterStudents() {
            const val = document.getElementById('search-student').value;
            document.getElementById('students-table-body').innerHTML = getStudentsRows(val);
            lucide.createIcons();
        }

        function changeSubject(sub) {
            currentSubject = sub;
            renderGrades();
            lucide.createIcons();
        }

        function changeGradeLevel(val) {
            currentGradeLevel = val;
            renderGrades();
            lucide.createIcons();
        }

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modals) ---

        function openModal(type) {
            const modal = document.getElementById('main-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            modal.classList.remove('hidden-modal');
            setTimeout(() => modal.classList.add('active'), 10);

            // Ù†ØµÙˆØµ ÙˆØ£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ØªØ­ØªØ§Ø¬ ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
            const inputClass = "w-full border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-lg p-3 outline-none focus:ring-2 ring-primary dark:ring-teal-500 transition-colors dark:text-white placeholder-slate-400";
            const selectClass = "w-full border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-lg p-3 outline-none dark:text-white";

            if (type === 'addStudent') {
                title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯';
                body.innerHTML = `
                    <form onsubmit="handleAddStudent(event)" class="space-y-4">
                        <input name="name" required placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" class="${inputClass}">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <select name="grade" class="${selectClass}">
                                ${schoolGrades.map(g => `<option value="${g}">${g}</option>`).join('')}
                            </select>
                            <input name="section" required placeholder="Ø§Ù„Ù‚Ø³Ù… (Ø£ØŒ Ø¨..)" class="${inputClass}">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <select name="shift" class="${selectClass}">
                                <option value="ØµØ¨Ø§Ø­ÙŠ">Ø¯ÙˆØ§Ù… ØµØ¨Ø§Ø­ÙŠ â˜€ï¸</option>
                                <option value="Ø¸Ù‡Ø±ÙŠ">Ø¯ÙˆØ§Ù… Ø¸Ù‡Ø±ÙŠ ğŸŒ‘</option>
                            </select>
                            <input name="phone" required placeholder="Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" class="${inputClass}">
                        </div>
                        <button type="submit" class="w-full bg-primary dark:bg-teal-600 text-white py-3 rounded-lg font-bold hover:bg-secondary dark:hover:bg-teal-700 transition shadow-lg">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    </form>
                `;
            } else if (type === 'addTeacher') {
                title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù… Ø¬Ø¯ÙŠØ¯';
                body.innerHTML = `
                    <form onsubmit="handleAddTeacher(event)" class="space-y-4">
                        <input name="name" required placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…" class="${inputClass}">
                        <select name="subject" class="${selectClass}">
                            ${schoolSubjects.map(sub => `<option value="${sub}">${sub}</option>`).join('')}
                        </select>
                        <input name="phone" required placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="${inputClass}">
                        <button type="submit" class="w-full bg-slate-800 dark:bg-slate-700 text-white py-3 rounded-lg font-bold hover:bg-slate-900 dark:hover:bg-slate-600 transition shadow-lg">Ø¥Ø¶Ø§ÙØ©</button>
                    </form>
                `;
            } else if (type === 'addNotif') {
                title.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù…';
                body.innerHTML = `
                    <form onsubmit="handleAddNotif(event)" class="space-y-4">
                        <input name="title" required placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±" class="${inputClass}">
                        <textarea name="body" required placeholder="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©..." rows="3" class="${inputClass}"></textarea>
                        <div class="flex gap-4 dark:text-slate-300">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" value="info" checked class="accent-blue-600"> <span>Ù…Ø¹Ù„ÙˆÙ…Ø©</span></label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="type" value="alert" class="accent-red-600"> <span>ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…</span></label>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition shadow-lg">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ÙƒÙ„</button>
                    </form>
                `;
            }
        }

        function closeModal() {
            const modal = document.getElementById('main-modal');
            modal.classList.remove('active');
            setTimeout(() => modal.classList.add('hidden-modal'), 200);
        }

        // --- Ø¥Ø¯Ø§Ø±Ø© Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø°Ù (Delete Modal) ---

        function openDeleteModal(type, id) {
            deleteTarget = { type, id };
            const modal = document.getElementById('confirm-modal');
            modal.classList.remove('hidden-modal');
            setTimeout(() => modal.classList.add('active'), 10);
        }

        function closeDeleteModal() {
            const modal = document.getElementById('confirm-modal');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.add('hidden-modal');
                deleteTarget = null;
            }, 200);
        }

        function confirmDelete() {
            if (!deleteTarget) return;

            if (deleteTarget.type === 'student') {
                students = students.filter(s => s.id !== deleteTarget.id);
                renderStudents();
            } else if (deleteTarget.type === 'teacher') {
                teachers = teachers.filter(t => t.id !== deleteTarget.id);
                renderTeachers();
            }
            saveData();
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            closeDeleteModal();
        }

        // --- Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ (Form Handlers) ---

        function handleAddStudent(e) {
            e.preventDefault();
            const form = new FormData(e.target);
            students.unshift({
                id: Date.now(),
                name: form.get('name'),
                grade: form.get('grade'),
                section: form.get('section'),
                shift: form.get('shift'),
                phone: form.get('phone'),
                marks: {},
                attendanceHistory: []
            });
            saveData();
            closeModal();
            renderStudents();
            showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function handleAddTeacher(e) {
            e.preventDefault();
            const form = new FormData(e.target);
            teachers.push({
                id: Date.now(),
                name: form.get('name'),
                subject: form.get('subject'),
                phone: form.get('phone')
            });
            saveData();
            closeModal();
            renderTeachers();
            showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ù„Ù…');
        }

        function handleAddNotif(e) {
            e.preventDefault();
            const form = new FormData(e.target);
            notifications.unshift({
                id: Date.now(),
                title: form.get('title'),
                body: form.get('body'),
                type: form.get('type'),
                date: new Date().toLocaleDateString('ar-EG')
            });
            saveData();
            closeModal();
            renderNotifications();
            showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
        }

        function saveAttendance() {
            const today = new Date().toISOString().split('T')[0];
            students.forEach(s => {
                const radio = document.querySelector(`input[name="att_${s.id}"]:checked`);
                if(radio) {
                    s.attendanceHistory = s.attendanceHistory.filter(d => d.date !== today);
                    s.attendanceHistory.push({ date: today, status: radio.value });
                }
            });
            saveData();
            showToast('ØªÙ… Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„ÙŠÙˆÙ…');
        }

        function saveGrades() {
            students.forEach(s => {
                const e1 = document.getElementById(`g_e1_${s.id}`)?.value;
                const mid = document.getElementById(`g_mid_${s.id}`)?.value;
                const fin = document.getElementById(`g_fin_${s.id}`)?.value;
                
                // Ø­ÙØ¸ ÙÙ‚Ø· Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠÙ† ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©)
                if (e1 !== undefined) {
                    s.marks[currentSubject] = { e1, mid, fin };
                    
                    const total = (Number(e1)||0) + (Number(mid)||0) + (Number(fin)||0);
                    const totalEl = document.getElementById(`g_total_${s.id}`);
                    if(totalEl) totalEl.textContent = total;
                }
            });
            saveData();
            showToast(`ØªÙ… Ø­ÙØ¸ Ø¯Ø±Ø¬Ø§Øª Ù…Ø§Ø¯Ø© ${currentSubject} Ù„Ù„ØµÙ ${currentGradeLevel}`);
        }

        function updateNotifBadge() {
            const badge = document.getElementById('notif-badge');
            if(badge) {
                badge.classList.toggle('hidden', notifications.length === 0);
            }
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'bg-slate-800 dark:bg-slate-700 text-white px-6 py-3 rounded-lg shadow-xl mb-3 flex items-center gap-3 fade-in ring-1 ring-slate-700 dark:ring-slate-600';
            toast.innerHTML = `<i data-lucide="check-circle" class="text-green-400 w-5 h-5"></i><span>${msg}</span>`;
            document.getElementById('toast-container').appendChild(toast);
            lucide.createIcons();
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        window.addEventListener('DOMContentLoaded', () => {
            initManifest(); // ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Manifest Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
            initTheme(); // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø«ÙŠÙ…
            router('dashboard');
        });
    </script>
</body>
</html>
